# x265参数解析



参考资料

* <https://tieba.baidu.com/p/6627144750>

* <https://x265.readthedocs.io/en/3.1/cli.html>

* <https://vcb-s.nmm-hd.org/Dark%20Shrine/[VCB-Studio][教程10]x265%202.9参数设置/[VCB-Studio][教程10]x265%202.9参数设置.pdf>


**请注意，不能确保完全正确**




# crf,qp

**qp** 电脑认为的恒定画质(但一般不进行设置)

**crf** 人眼认为的恒定画质，但是运动时候画质会降低来节省码率

数值越低画质越好。

一般低于等于18可以认为和原画差不多(主观观点)



# ctu <64|32|16>

分块大小，64速度最慢，32其次

设成32 对于复杂场景压缩压缩率最高，64 对于简单场景压缩压缩率最高

推荐用32因为速度比64快10%，并且画质更好一些

16适合DVD，32适合1080p,64适合4K



# rd (1-6)

分析的复杂度，数值越大画质越高，压出来体积越大，5,6非常慢, 默认3.



# early-skip

--early-skip, --no-early-skip

默认开，开了提高压缩速度，关了提高精度，体积小幅度增加





# rdoq-level

默认0,关闭，预设slow时候默认开启。(preset placebo 似乎也还是2)

x265最重要的参数，没有之一，开了能有助于保存细节，当然会有更大文件体积。关闭可以提高压缩速度，看起来会轻度模糊。开启掉速度30%以上，推荐舍弃其他参数，也要开启这个。

设成 1 时候 看起来效果最好，但是体积会大30%以上

设成 2 时候 效果略差，体积只会小幅度增加，推荐使用2





# tu-intra-depth <1..4> tu-inter-depth <1..4>

默认1，开高会小幅增加压缩率，但是特别慢 (preset placebo 似乎就是4)



# max-tu-size <32|16|8|4>

默认32，开低会降低压缩率，并且不会提速，推荐默认





# max-merge <1..5>

开高小幅度提高压缩率，对速度影响不明显，默认2 (preset placebo 似乎就是5)





# me ,merange

me 搜索方式，默认hex ，用umh 或star 能小幅度提高压缩率，但是掉速20%

merange 搜索范围，默认57，me设成hex时候，对速度影响不大，但是使用umh或star时候，开高掉速严重

umh比star好

1. dia

2. hex (default)

3. umh

4. star

5. sea

6. full



# subme 默认2

开高小幅提高压缩率，开低提高压缩速度，5比3慢10%

推荐3



# min-keyint

最小分组帧数，默认23，推荐改成个位数，提高gop准确度。

小幅度提高压缩率，对压缩速度没影响



# rc-lookahead

预览帧数，默认20

开高可以提高分组(gop)准确度，小幅度提高压缩率，同时小幅度降速，推荐40

crf模式时，rc-lookahead可以提高cutree的准确度（提高画质)





# bframes

最大b帧数量

开高小幅度提高压缩率，默认4，开到8，掉速10%

bframes 开高了会小幅降低画质



# cutree

--no-cutree since this seems to be a poor implementation of mbtree.

~~目前测试是静态场景表现不错，具体可以看<https://ted423.github.io/Document/Encode/cutree/>~~ 不建议开，码率分配存在非常大的问题(有一处分配了31M的码率结果效果还不如一半码率的x264)

doom9 上2020年有人说"在快速移动的场景中，我一直在努力解决丑陋的扭曲（用条带涂抹看起来有点像运动模糊的东西），最后发现 x265 的 CUTree 是罪魁祸首。

关闭它可以解决它，但是当试图在其他场景中保持相同的整体质量时，比特率会爆炸。



有什么方法可以使 CUTree '不那么激进' 或将其设置为 50% 或某些阈值参数吗？"



# ref

参照帧数量，默认3

开高小幅度提高压缩率，同时小幅度降速，

3和4速度差不多，推荐4

VCB:不过实测 ref 增加在 x265 中作用不明显。建议不超过 6





# sao 默认开启

--sao, --no-sao

设计目的是去振铃(光环现象)，但是细节丰富地方会去掉太多细节，

推荐关闭。





# strong-intra-smoothing



对关键帧进行平滑处理，看起来挺吓人的，实际上效果不明显，推荐用`--no-strong-intra-smoothing`关闭，保留细节

<http://forum.doom9.net/showthread.php?p=1873696>

相关讨论，与贴吧给出的结论不同

个人测试是开的话画面细节丢失，影响蛮大(可能适合低码压制)



# lookahead-slices

设成0有助于提高画质，开高有利于lookahead的并行度，

推荐设成0，对压缩速度无影响





# lookahead-slices

设成0有助于提高画质，开高有利于lookahead的并行度，

推荐设成0，对压缩速度无影响



# deblock 去色块

要调低 默认太高， 推荐最高调到-1,-1以下，调高了会模糊





# qcomp

运动时候画质 crf开启时候有效

开高提高运动时候画质，开低减少文件体积

推荐0.6-0.7





# frame-threads

帧线程数量，开高提高cpu利用率，开低有利于小幅度提高压缩率

如果cpu能够满载可以考虑调到2，如果不能满载考虑使用默认值

(默认会自动调整)



# aq-strength 默认1.0

低于1.0首先保留边缘，高于1.0优先保留纹理

不知道不要乱调这个

VCB:aq-strength 决定了 aq 的强度，一般来说，动漫的 aq-strength 不用太高（太高了码率也会

浪费）。通常，aq-mode=1，aq-strength 给 0.8 比较合理；aq-mode=2，aq-strength 给 0.9 左右，aq-mode=3，

aq-strength 给 0.7 左右。





# aq-mode

 2 x265默认（推荐）

3 暗处增强，避免暗处被压坏，实际上亮的地方码率也会增加30%以上，所以很 浪费码率(不过就压制而言，通常是差不多码率进行比较，因此浪费码率可以通过调高crf解决)

 aq-mode 4 :优先保留边缘，噪点很多时候用

VCB:x265 目前有三种 aq 模式。aq-mode 1 是最安全稳定的 aq，适合高码率/高画质编码；aq-mode

2 相对来说效率最高，适合中低码率的编码；aq-mode 3 对暗场进行加强，适合 8bit 编码防止暗场压烂。一般 10bit

编码根据 crf 高低决定 aq 选取，个人建议在 crf <= 16 时候使用 aq-mode 1，否则使用 aq-mode 2。注意同 crf

下，不同 aq-mode 出来的体积是不一样的，3>1>2。





# rskip <0|1|2>

开启提高速度，关闭提高画质，0是关闭，默认1

模式1比0 wmaf 下降0.03左右

模式2比模式1压缩速度要快30%-50%左右，但是压缩率要低

对于平滑画面（噪点比较少）画质优于rskip=1，但是噪点比较多画面 画质不如rskip=1

rskip=2 和ctu=64配合不好，同时开启画质压缩率都会下降

~~推荐rskip=2 和ctu=32配合~~(我们一般不开)



# rect

--rect, --no-rect

开了小幅度增加压缩率（0%-5%左右 )和画质，有长方形区域时候才有效，否则是空跑，开了掉速30%以上

推荐关闭增加压缩速度。

VCB:通常来说，<=1080p 下，rect 基本上没什么作用，amp 是几乎完全没作用，但是这俩都

是速度黑洞。因此从效率角度建议关闭，或者至少关闭 amp

个人测试中，1080p开了之后，码率低了一点，画面差了一点



-----

<date>2021-11-17</data> 增加cutree相关

<date>2022-01-28</date> cutree调整为不建议开